window.ol||(window.ol={});(function(){var d,h,g,f=true,e={boxid:"ol_box",boxclass:"ol_box",type:"dialog",title:"",width:0,height:0,showTitle:true,showButton:true,showCancel:true,showOk:true,okBtnName:"\u786e\u5b9a",cancelBtnName:"\u53d6\u6d88",timeout:0,draggable:true,modal:true,zIndex:500,remember:false,position:"center",clickOut:null,onclose:null,onopen:null,oncancel:null,onok:null,blur:null,focus:null,autoHeight:true,autoPosition:true,cache:false};var a=function(){return document.compatMode=="CSS1Compat"?document.documentElement:document.body};var b=function(){var i=a();return{width:Math.max(i.scrollWidth,i.clientWidth||0)-1,height:Math.max(i.scrollHeight,i.clientHeight||0)-1}};var c={};c.dialog={html:'<div><div class="box-ct">	<div class="box-header">		<div class="box-tl"></div>		<div class="box-tc">			<div class="box-tc1"></div>			<div class="box-tc2"><a href="javascript:;" onclick="return false;" title="\u5173\u95ed" class="box-close"></a><span class="box-title"></span></div>		</div>		<div class="box-tr"></div>	</div>	<table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;background:#fff;">		<tr>			<td class="box-cl"></td>			<td class="box-cc">				<div class="box-content"></div>				<div class="box-button">					<a class="box-cancel" href="javascript:;"><span>\u53d6\u6d88</span></a>					<a class="box-ok" href="javascript:;"><span>\u786e\u5b9a</span></a>				</div>			</td>			<td class="box-cr"></td>		</tr>	</table>	<div class="box-bottom">		<div class="box-bl"></div>		<div class="box-bc"></div>		<div class="box-br"></div>	</div></div></div>',initContent:function(i){i.setContent(i.content)},setContent:function(i,j,k){i.content=j||i.content;i.setContent(i.content);if(typeof(k)=="function"){k()}}};c.ajax={initContent:function(i){},setContent:function(i,j,l){i._b_button.hide();i.setContent('<div class="box-loading"></div>');if(i._b_content.height()<90){i._b_content.height(Math.max(90,i.options.height))}if(i._box.width()<200){i._box.width(Math.max(200,i.options.width))}var k=j||i.content;if(typeof(k)!="string"){alert("please set ajax url.");return}i.content=k;if(i.options.cache==false){if(k.indexOf("?")==-1){k+="?_t="+Math.random()}else{k+="&_t="+Math.random()}}d.get(k,function(m){if(i.options.showButton){i._b_button.show()}i.setContent(m);if(typeof(l)=="function"){l()}})}};c.iframe={initContent:function(i){},setContent:function(i,l,m){var k=l||i.content;if(typeof(k)!="string"){alert("please set iframe url.");return}i.content=k;var j="box-iframe-"+(new Date()).getTime();i.setContent('<iframe class="boxIframe" width="100%" height="100%" frameborder="0" name="'+j+'"></iframe><script>window["'+j+'"].location.href="'+k+'";<\/script>');if(typeof(m)=="function"){m()}},closeEvent:function(i){if(!i.options.remember){i.find("iframe").each(function(){this.contentWindow.close();jQuery(this).remove()})}}};ol.box=function(j,i){this.options=null;this._type=null;this._mask=null;this._events={};this._box=null;this._b_content=null;this._b_button=null;this.content=j;this._initedContent=false;this._onbox=false;this._isOpen=false;d=jQuery;h=d(window);g=d(document);f=d.browser.msie&&(d.browser.version=="6.0"),this.options=d.extend({},e,i);this.init()};ol.box.prototype={init:function(){this.initConfig();if(this.options.modal){this.initMask()}this.initBox();this.initEvent()},initBox:function(){d("#"+this.options.boxid).remove();this._box=d(this._type.html).css({visibility:"hidden",position:"absolute",top:0,left:0,zIndex:this.options.zIndex}).bgiframe();this._b_button=this._box.find(".box-button");this._b_content=this._box.find(".box-content");this.renderBox(this.options);this._box.appendTo("body");this._type.initContent(this)},initConfig:function(){switch(this.options.type){case"ajax":this._type=c.ajax;break;case"iframe":this._type=c.iframe;break;default:this._type=c.dialog;break}this._type=d.extend({},c.dialog,this._type)},initEvent:function(){var i=this;if(this.options.draggable&&this.options.showTitle){this._box.find(".box-header").mousedown(function(l){var k=this;o=document,ox=parseInt(i._box.css("left"),10),oy=parseInt(i._box.css("top"),10),mx=l.clientX,my=l.clientY,size=b(),box_w=i._box.outerWidth(true),box_h=i._box.outerHeight(true);if(k.setCapture){k.setCapture()}var j=function(n){if(window.getSelection){window.getSelection().removeAllRanges()}else{document.selection.empty()}var q=Math.max(ox+n.clientX-mx,0),p=Math.max(oy+n.clientY-my,0);q=Math.min(q,size.width-box_w);p=Math.min(p,size.height-box_h);i._box.css({left:q,top:p})};var m=function(){if(k.releaseCapture){k.releaseCapture()}g.unbind("mousemove",j);g.unbind("mouseup",m)};g.mousemove(j).mouseup(m)})}else{this._box.find(".box-header").css("cursor","default")}},renderBox:function(i){var j={zIndex:i.zIndex,position:"absolute"};if(i.boxid){this._box.attr("id",i.boxid)}if(i.boxclass){this._box.attr("class",i.boxclass)}if(!i.showTitle){this._box.find(".box-header").hide()}else{this.setTitle(i.title)}if(!i.showButton){this._b_button.hide()}else{if(!i.showCancel){this._b_button.find(".box-cancel").hide()}if(!i.showOk){this._b_button.find(".box-ok").hide()}}this._b_button.find(".box-ok span").html(i.okBtnName);this._b_button.find(".box-cancel span").html(i.cancelBtnName);this._box.css(j)},setTitle:function(i){if(i.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,"")==""){this._box.find(".box-title").remove();return this}this._box.find(".box-title").html(i);return this},setContent:function(j){if(typeof(j)=="undefined"||j==null){return}this._initedContent=true;this._b_content.empty().html(j);var k=this;if(this.options.width>0){this._box.css("width",this.options.width)}else{this._box.css("width",null)}if(this.options.height>0){var i={height:this.options.height};this.options.autoHeight||(i["overflow-y"]="auto");this._b_content.css(i)}else{this._b_content.css("height","auto")}this.setPosition();this._box.find(".box-close, .box-cancel, .box-ok").unbind("click").click(function(){k.close()});if(typeof(this.options.onok)=="function"){this._box.find(".box-ok").unbind("click").click(function(){k.options.onok.call(this,k)})}if(typeof(this.options.oncancel)=="function"){this._box.find(".box-cancel").unbind("click").click(function(){k.options.oncancel.call(this,k)})}this._box.find(".box-close, .box-cancel, .box-ok").unbind("keypress").bind("keypress",function(m){m=m||window.event;var l=m.which||m.charCode||m.keyCode;switch(l){case 27:k.close();return false;case 32:case 13:d(document.activeElement).trigger("click");return false}})},openEvent:function(){if(this._isOpen){return}var i=this;if(this.options.autoPosition){if(this.options.position!="center"){var j;this._events.scroll=function(){clearTimeout(j);j=setTimeout(function(){i.setPosition()},300)};h.scroll(this._events.scroll)}this._events.resize=function(){i.setPosition()};h.resize(this._events.resize)}if(this.options.timeout>0){this._events.timeout=setTimeout(function(){i.close()},this.options.timeout)}this._onbox=true;if(this.options.clickOut){this._events.box_click=function(k){i._onbox=true};this._events.document_click=function(k){if(k.button!=0){return true}if(i._onbox===false){i.options.clickOut(i)}i._onbox=false};this._box.bind("click",this._events.box_click);g.bind("click",this._events.document_click)}if(this.options.modal){this.showMask()}if(this.options.onopen){this.options.onopen(this)}if(this.options.focus){d(this.options.focus).focus()}this._isOpen=true},closeEvent:function(){clearTimeout(this._events.timeout);if(this._events.scroll){h.unbind("scroll",this._events.scroll)}if(this._events.resize){h.unbind("resize",this._events.resize)}if(this._events.box_click){this._box.unbind("click",this._events.box_click)}if(this._events.document_click){g.unbind("click",this._events.document_click)}if(this.options.modal){this.hideMask()}if(this.options.onclose){this.options.onclose(this)}if(this.options.blur){d(this.options.blur).focus()}this._isOpen=false;if(this._type.closeEvent){this._type.closeEvent(this)}},setPosition:function(){if(this.options.position=="center"){var n=h.height();var u=h.width();var p=this._box.outerWidth(true);var j=this._b_content.outerHeight(true);var k=this._box.find(".box-header:first").outerHeight(true);var r=this._box.find(".box-bottom:first").outerHeight(true);var i=j+k+r;var q={x:(u-p)/2,y:(n-i)/2};var t={position:"fixed"};if(q.x<0){t.width=u;q.x=0}if(q.y<0){t.height=n;q.y=0}t.top=q.y;t.left=q.x;if(f){t.position="absolute";var s=d("html");if(!s.css("background-image")||s.css("background-image")=="none"){s.css("background-image","url(about:blank)")}this._box[0].style.setExpression("left","(document.documentElement || document.body).scrollLeft+"+t.left+'+"px"');this._box[0].style.setExpression("top","(document.documentElement || document.body).scrollTop+"+t.top+'+"px"');delete t.top;delete t.left}this._box.css(t);return}else{if(Object.prototype.toString.call(this.options.position)==="[object Object]"){var v=this.options.position.top||0;var m=this.options.position.left||0;if(this.options.position.ref){var l=d(this.options.position.ref);var q=l.offset();v+=q.top;v+=l.outerHeight(true);m+=q.left}this._box.css({top:v,left:m})}}},renderContent:function(i,j){if(typeof(i)!="undefined"&&i!=null){this._initedContent=false}if(!this._initedContent||!this.options.remember){this._type.setContent(this,i,j)}else{this.setPosition();this.openEvent()}},open:function(j,i){if(this._isOpen){this.closeEvent()}this.options=d.extend({},this.options,i);var k=this;this.renderContent(j,function(){k.openEvent()});this._box.stop().css({visibility:"visible",opacity:null});return this},close:function(){this.closeEvent();this._box.css("visibility","hidden")},isOpen:function(){return this._isOpen},fadeIn:function(l,k,j){this.options=d.extend({},this.options,k);this.renderContent(l);var i=this._box.css("opacity")||1;this._box.css({opacity:0,visibility:"visible"}).stop().animate({opacity:i},j);this.openEvent()},fadeOut:function(i){var j=this;this.closeEvent();this._box.stop().animate({opacity:0},i,function(){j._box.css({visibility:"hidden",opacity:null})})},find:function(i){return this._b_content.find(i)},getBox:function(){return this._box},initMask:function(){if(d(".ol_box_mask")){d(".ol_box_mask").remove()}this._mask=d("<div class='ol_box_mask'></div>").css({visibility:"hidden",width:0,height:0,zIndex:this.options.zIndex}).appendTo("body").bgiframe();var i=this;this._events.masker_resize=function(){i._mask.css(b())}},showMask:function(){var i=b();i.visibility="visible";this._mask.css(i);h.bind("resize",this._events.masker_resize)},hideMask:function(){this._mask.css({visibility:"hidden",width:0,height:0});h.unbind("resize",this._events.masker_resize)}}})();
